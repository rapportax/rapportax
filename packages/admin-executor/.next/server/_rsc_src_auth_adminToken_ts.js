"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "_rsc_src_auth_adminToken_ts";
exports.ids = ["_rsc_src_auth_adminToken_ts"];
exports.modules = {

/***/ "(rsc)/./src/auth/adminToken.ts":
/*!********************************!*\
  !*** ./src/auth/adminToken.ts ***!
  \********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getAdminTokenInfo: () => (/* binding */ getAdminTokenInfo),\n/* harmony export */   issueAdminToken: () => (/* binding */ issueAdminToken),\n/* harmony export */   verifyAdminToken: () => (/* binding */ verifyAdminToken)\n/* harmony export */ });\n/* harmony import */ var _db_pool__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../db/pool */ \"(rsc)/./src/db/pool.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_db_pool__WEBPACK_IMPORTED_MODULE_0__]);\n_db_pool__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\nconst DEFAULT_TTL_MINUTES = 60;\nasync function issueAdminToken(actorId) {\n    const pool = (0,_db_pool__WEBPACK_IMPORTED_MODULE_0__.getPool)();\n    const token = crypto.randomUUID();\n    const expiresAt = new Date(Date.now() + DEFAULT_TTL_MINUTES * 60 * 1000);\n    await pool.query(`INSERT INTO admin_tokens (token, actor_id, expires_at)\n     VALUES ($1, $2, $3)`, [\n        token,\n        actorId,\n        expiresAt\n    ]);\n    return token;\n}\nasync function verifyAdminToken(token, actorId) {\n    const pool = (0,_db_pool__WEBPACK_IMPORTED_MODULE_0__.getPool)();\n    const result = await pool.query(`SELECT token, actor_id, expires_at\n     FROM admin_tokens\n     WHERE token = $1`, [\n        token\n    ]);\n    if (result.rowCount === 0) {\n        return false;\n    }\n    const row = result.rows[0];\n    if (actorId && row.actor_id !== actorId) {\n        return false;\n    }\n    if (new Date(row.expires_at).getTime() < Date.now()) {\n        return false;\n    }\n    return true;\n}\nasync function getAdminTokenInfo(token) {\n    const pool = (0,_db_pool__WEBPACK_IMPORTED_MODULE_0__.getPool)();\n    const result = await pool.query(`SELECT actor_id, expires_at\n     FROM admin_tokens\n     WHERE token = $1`, [\n        token\n    ]);\n    if (result.rowCount === 0) {\n        return null;\n    }\n    const row = result.rows[0];\n    if (new Date(row.expires_at).getTime() < Date.now()) {\n        return null;\n    }\n    return {\n        actorId: row.actor_id,\n        expiresAt: row.expires_at\n    };\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXV0aC9hZG1pblRva2VuLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBcUM7QUFFckMsTUFBTUMsc0JBQXNCO0FBRXJCLGVBQWVDLGdCQUFnQkMsT0FBZTtJQUNuRCxNQUFNQyxPQUFPSixpREFBT0E7SUFDcEIsTUFBTUssUUFBUUMsT0FBT0MsVUFBVTtJQUMvQixNQUFNQyxZQUFZLElBQUlDLEtBQUtBLEtBQUtDLEdBQUcsS0FBS1Qsc0JBQXNCLEtBQUs7SUFFbkUsTUFBTUcsS0FBS08sS0FBSyxDQUNkLENBQUM7d0JBQ21CLENBQUMsRUFFckI7UUFBQ047UUFBT0Y7UUFBU0s7S0FBVTtJQUc3QixPQUFPSDtBQUNUO0FBRU8sZUFBZU8saUJBQ3BCUCxLQUFhLEVBQ2JGLE9BQWdCO0lBRWhCLE1BQU1DLE9BQU9KLGlEQUFPQTtJQUNwQixNQUFNYSxTQUFTLE1BQU1ULEtBQUtPLEtBQUssQ0FDN0IsQ0FBQzs7cUJBRWdCLENBQUMsRUFDbEI7UUFBQ047S0FBTTtJQUdULElBQUlRLE9BQU9DLFFBQVEsS0FBSyxHQUFHO1FBQ3pCLE9BQU87SUFDVDtJQUVBLE1BQU1DLE1BQU1GLE9BQU9HLElBQUksQ0FBQyxFQUFFO0lBSzFCLElBQUliLFdBQVdZLElBQUlFLFFBQVEsS0FBS2QsU0FBUztRQUN2QyxPQUFPO0lBQ1Q7SUFFQSxJQUFJLElBQUlNLEtBQUtNLElBQUlHLFVBQVUsRUFBRUMsT0FBTyxLQUFLVixLQUFLQyxHQUFHLElBQUk7UUFDbkQsT0FBTztJQUNUO0lBRUEsT0FBTztBQUNUO0FBRU8sZUFBZVUsa0JBQ3BCZixLQUFhO0lBRWIsTUFBTUQsT0FBT0osaURBQU9BO0lBQ3BCLE1BQU1hLFNBQVMsTUFBTVQsS0FBS08sS0FBSyxDQUM3QixDQUFDOztxQkFFZ0IsQ0FBQyxFQUNsQjtRQUFDTjtLQUFNO0lBR1QsSUFBSVEsT0FBT0MsUUFBUSxLQUFLLEdBQUc7UUFDekIsT0FBTztJQUNUO0lBRUEsTUFBTUMsTUFBTUYsT0FBT0csSUFBSSxDQUFDLEVBQUU7SUFDMUIsSUFBSSxJQUFJUCxLQUFLTSxJQUFJRyxVQUFVLEVBQUVDLE9BQU8sS0FBS1YsS0FBS0MsR0FBRyxJQUFJO1FBQ25ELE9BQU87SUFDVDtJQUVBLE9BQU87UUFBRVAsU0FBU1ksSUFBSUUsUUFBUTtRQUFFVCxXQUFXTyxJQUFJRyxVQUFVO0lBQUM7QUFDNUQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AcmFwcG9ydGF4L2FkbWluLWV4ZWN1dG9yLy4vc3JjL2F1dGgvYWRtaW5Ub2tlbi50cz8xNzZkIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGdldFBvb2wgfSBmcm9tIFwiLi4vZGIvcG9vbFwiO1xuXG5jb25zdCBERUZBVUxUX1RUTF9NSU5VVEVTID0gNjA7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBpc3N1ZUFkbWluVG9rZW4oYWN0b3JJZDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgY29uc3QgcG9vbCA9IGdldFBvb2woKTtcbiAgY29uc3QgdG9rZW4gPSBjcnlwdG8ucmFuZG9tVVVJRCgpO1xuICBjb25zdCBleHBpcmVzQXQgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgREVGQVVMVF9UVExfTUlOVVRFUyAqIDYwICogMTAwMCk7XG5cbiAgYXdhaXQgcG9vbC5xdWVyeShcbiAgICBgSU5TRVJUIElOVE8gYWRtaW5fdG9rZW5zICh0b2tlbiwgYWN0b3JfaWQsIGV4cGlyZXNfYXQpXG4gICAgIFZBTFVFUyAoJDEsICQyLCAkMylgXG4gICAgLFxuICAgIFt0b2tlbiwgYWN0b3JJZCwgZXhwaXJlc0F0XSxcbiAgKTtcblxuICByZXR1cm4gdG9rZW47XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlBZG1pblRva2VuKFxuICB0b2tlbjogc3RyaW5nLFxuICBhY3RvcklkPzogc3RyaW5nLFxuKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIGNvbnN0IHBvb2wgPSBnZXRQb29sKCk7XG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBvb2wucXVlcnkoXG4gICAgYFNFTEVDVCB0b2tlbiwgYWN0b3JfaWQsIGV4cGlyZXNfYXRcbiAgICAgRlJPTSBhZG1pbl90b2tlbnNcbiAgICAgV0hFUkUgdG9rZW4gPSAkMWAsXG4gICAgW3Rva2VuXSxcbiAgKTtcblxuICBpZiAocmVzdWx0LnJvd0NvdW50ID09PSAwKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgY29uc3Qgcm93ID0gcmVzdWx0LnJvd3NbMF0gYXMge1xuICAgIGFjdG9yX2lkOiBzdHJpbmc7XG4gICAgZXhwaXJlc19hdDogRGF0ZTtcbiAgfTtcblxuICBpZiAoYWN0b3JJZCAmJiByb3cuYWN0b3JfaWQgIT09IGFjdG9ySWQpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpZiAobmV3IERhdGUocm93LmV4cGlyZXNfYXQpLmdldFRpbWUoKSA8IERhdGUubm93KCkpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEFkbWluVG9rZW5JbmZvKFxuICB0b2tlbjogc3RyaW5nLFxuKTogUHJvbWlzZTx7IGFjdG9ySWQ6IHN0cmluZzsgZXhwaXJlc0F0OiBEYXRlIH0gfCBudWxsPiB7XG4gIGNvbnN0IHBvb2wgPSBnZXRQb29sKCk7XG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHBvb2wucXVlcnkoXG4gICAgYFNFTEVDVCBhY3Rvcl9pZCwgZXhwaXJlc19hdFxuICAgICBGUk9NIGFkbWluX3Rva2Vuc1xuICAgICBXSEVSRSB0b2tlbiA9ICQxYCxcbiAgICBbdG9rZW5dLFxuICApO1xuXG4gIGlmIChyZXN1bHQucm93Q291bnQgPT09IDApIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGNvbnN0IHJvdyA9IHJlc3VsdC5yb3dzWzBdIGFzIHsgYWN0b3JfaWQ6IHN0cmluZzsgZXhwaXJlc19hdDogRGF0ZSB9O1xuICBpZiAobmV3IERhdGUocm93LmV4cGlyZXNfYXQpLmdldFRpbWUoKSA8IERhdGUubm93KCkpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHJldHVybiB7IGFjdG9ySWQ6IHJvdy5hY3Rvcl9pZCwgZXhwaXJlc0F0OiByb3cuZXhwaXJlc19hdCB9O1xufVxuIl0sIm5hbWVzIjpbImdldFBvb2wiLCJERUZBVUxUX1RUTF9NSU5VVEVTIiwiaXNzdWVBZG1pblRva2VuIiwiYWN0b3JJZCIsInBvb2wiLCJ0b2tlbiIsImNyeXB0byIsInJhbmRvbVVVSUQiLCJleHBpcmVzQXQiLCJEYXRlIiwibm93IiwicXVlcnkiLCJ2ZXJpZnlBZG1pblRva2VuIiwicmVzdWx0Iiwicm93Q291bnQiLCJyb3ciLCJyb3dzIiwiYWN0b3JfaWQiLCJleHBpcmVzX2F0IiwiZ2V0VGltZSIsImdldEFkbWluVG9rZW5JbmZvIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/auth/adminToken.ts\n");

/***/ }),

/***/ "(rsc)/./src/db/pool.ts":
/*!************************!*\
  !*** ./src/db/pool.ts ***!
  \************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getPool: () => (/* binding */ getPool)\n/* harmony export */ });\n/* harmony import */ var pg__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! pg */ \"pg\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([pg__WEBPACK_IMPORTED_MODULE_0__]);\npg__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\nconst DEFAULT_CONNECTION = \"postgres://rapportax:rapportax@localhost:5432/rapportax\";\nlet pool = null;\nfunction getPool() {\n    if (!pool) {\n        pool = new pg__WEBPACK_IMPORTED_MODULE_0__.Pool({\n            connectionString: process.env.DATABASE_URL ?? DEFAULT_CONNECTION\n        });\n    }\n    return pool;\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvZGIvcG9vbC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUEwQjtBQUUxQixNQUFNQyxxQkFDSjtBQUVGLElBQUlDLE9BQW9CO0FBRWpCLFNBQVNDO0lBQ2QsSUFBSSxDQUFDRCxNQUFNO1FBQ1RBLE9BQU8sSUFBSUYsb0NBQUlBLENBQUM7WUFDZEksa0JBQ0VDLFFBQVFDLEdBQUcsQ0FBQ0MsWUFBWSxJQUFJTjtRQUNoQztJQUNGO0lBQ0EsT0FBT0M7QUFDVCIsInNvdXJjZXMiOlsid2VicGFjazovL0ByYXBwb3J0YXgvYWRtaW4tZXhlY3V0b3IvLi9zcmMvZGIvcG9vbC50cz8xNGEzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBvb2wgfSBmcm9tIFwicGdcIjtcblxuY29uc3QgREVGQVVMVF9DT05ORUNUSU9OID1cbiAgXCJwb3N0Z3JlczovL3JhcHBvcnRheDpyYXBwb3J0YXhAbG9jYWxob3N0OjU0MzIvcmFwcG9ydGF4XCI7XG5cbmxldCBwb29sOiBQb29sIHwgbnVsbCA9IG51bGw7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRQb29sKCk6IFBvb2wge1xuICBpZiAoIXBvb2wpIHtcbiAgICBwb29sID0gbmV3IFBvb2woe1xuICAgICAgY29ubmVjdGlvblN0cmluZzpcbiAgICAgICAgcHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMID8/IERFRkFVTFRfQ09OTkVDVElPTixcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gcG9vbDtcbn1cbiJdLCJuYW1lcyI6WyJQb29sIiwiREVGQVVMVF9DT05ORUNUSU9OIiwicG9vbCIsImdldFBvb2wiLCJjb25uZWN0aW9uU3RyaW5nIiwicHJvY2VzcyIsImVudiIsIkRBVEFCQVNFX1VSTCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/db/pool.ts\n");

/***/ })

};
;