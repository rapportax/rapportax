openapi: 3.0.3
info:
  title: Admin Executor API
  version: 0.1.0
  description: |
    Mock admin API for plan/org/tier/credit management.
    Use /api/auth to issue a bearer token, then call admin endpoints.
servers:
  - url: http://localhost:3000
tags:
  - name: auth
  - name: users
  - name: orgs
  - name: admin
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
  schemas:
    ErrorResponse:
      type: object
      required: [ok, message]
      properties:
        ok:
          type: boolean
          example: false
        message:
          type: string
          example: unauthorized
    AuthRequest:
      type: object
      required: [username, password]
      properties:
        username:
          type: string
          example: admin
        password:
          type: string
          example: admin
    AuthResponse:
      type: object
      required: [ok, accessToken]
      properties:
        ok:
          type: boolean
          example: true
        accessToken:
          type: string
          example: 7f4d2b3d-1111-2222-3333-444444444444
    Actor:
      type: object
      required: [id, scopes]
      properties:
        id:
          type: string
          example: U123
        scopes:
          type: array
          items:
            type: string
          example: ["PERSONAL_PLAN_ADMIN"]
    AdminCommandRequest:
      type: object
      required: [rawText, actor]
      properties:
        rawText:
          type: string
          example: pro-plan grant --userId=user123
        actor:
          $ref: "#/components/schemas/Actor"
        credentials:
          type: object
          properties:
            username:
              type: string
            password:
              type: string
    AdminCommandResponse:
      type: object
      required: [ok, message]
      properties:
        ok:
          type: boolean
        message:
          type: string
    UserSummary:
      type: object
      required: [ok, userId, plan, orgId]
      properties:
        ok:
          type: boolean
        userId:
          type: string
        plan:
          type: string
        orgId:
          type: string
          nullable: true
    UserDetail:
      type: object
      required: [ok, userId, plan, org]
      properties:
        ok:
          type: boolean
        userId:
          type: string
        plan:
          type: string
        org:
          nullable: true
          type: object
          required: [id, tier, credit]
          properties:
            id:
              type: string
            tier:
              type: string
            credit:
              type: integer
    OrgSummary:
      type: object
      required: [ok, orgId, tier, credit]
      properties:
        ok:
          type: boolean
        orgId:
          type: string
        tier:
          type: string
        credit:
          type: integer
    PlanGrantRequest:
      type: object
      properties:
        plan:
          type: string
          example: pro
    OrgAssignRequest:
      type: object
      required: [orgId]
      properties:
        orgId:
          type: string
          example: org123
    TierUpdateRequest:
      type: object
      required: [tier]
      properties:
        tier:
          type: string
          example: pro
    CreditUpdateRequest:
      type: object
      properties:
        credit:
          type: integer
          example: 1200
        creditDelta:
          type: integer
          example: -50
paths:
  /api/auth:
    post:
      tags: [auth]
      summary: Issue admin bearer token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuthRequest"
      responses:
        "200":
          description: Token issued
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/admin:
    post:
      tags: [admin]
      summary: Execute admin command gateway
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AdminCommandRequest"
      responses:
        "200":
          description: Command executed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdminCommandResponse"
        "400":
          description: Invalid command
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/admin/users/{userId}:
    get:
      tags: [users]
      summary: Get user plan/org summary
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
      responses:
        "200":
          description: User summary
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserSummary"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/admin/users:
    get:
      tags: [users]
      summary: List users
      security:
        - bearerAuth: []
      responses:
        "200":
          description: User list
          content:
            application/json:
              schema:
                type: object
                required: [ok, users]
                properties:
                  ok:
                    type: boolean
                  users:
                    type: array
                    items:
                      type: object
                      required: [id, plan, orgId]
                      properties:
                        id:
                          type: string
                        plan:
                          type: string
                        orgId:
                          type: string
                          nullable: true
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/admin/users/{userId}/detail:
    get:
      tags: [users]
      summary: Get user plan + org detail
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
      responses:
        "200":
          description: User detail
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserDetail"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/admin/users/{userId}/plan/grant:
    post:
      tags: [users]
      summary: Grant or update user plan
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PlanGrantRequest"
      responses:
        "200":
          description: Plan updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserSummary"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/admin/users/{userId}/org/assign:
    post:
      tags: [users]
      summary: Assign user to org
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OrgAssignRequest"
      responses:
        "200":
          description: Org assigned
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserSummary"
        "400":
          description: Missing orgId
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/admin/orgs/{orgId}:
    get:
      tags: [orgs]
      summary: Get org tier/credit
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: orgId
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Org summary
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrgSummary"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/admin/orgs:
    get:
      tags: [orgs]
      summary: List orgs
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Org list
          content:
            application/json:
              schema:
                type: object
                required: [ok, orgs]
                properties:
                  ok:
                    type: boolean
                  orgs:
                    type: array
                    items:
                      type: object
                      required: [id, tier, credit]
                      properties:
                        id:
                          type: string
                        tier:
                          type: string
                        credit:
                          type: integer
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/admin/orgs/{orgId}/tier/update:
    post:
      tags: [orgs]
      summary: Update org tier
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: orgId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TierUpdateRequest"
      responses:
        "200":
          description: Tier updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrgSummary"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /api/admin/orgs/{orgId}/credit/update:
    post:
      tags: [orgs]
      summary: Update org credit (absolute or delta)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: orgId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreditUpdateRequest"
      responses:
        "200":
          description: Credit updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrgSummary"
        "400":
          description: Missing credit payload
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
